app-id: com.jetbrains.PyCharm-Professional
runtime: org.freedesktop.Sdk
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
command: pycharm
separate-locales: false
finish-args:
  - --share=ipc
  - --socket=x11
  - --share=network
  - --socket=pulseaudio
  - --filesystem=host
  - --socket=session-bus
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.freedesktop.secrets
  - --filesystem=xdg-run/keyring
  - --device=all
  - --env=PYCHARM_JDK=${FLATPAK_DEST}/jbr/
  - --env=PATH=/app/bin:/app/extensions/bin:/usr/bin
add-extensions:
  com.jetbrains.PyCharm.Extensions:
    directory: extensions
    version: '22.08'
    add-ld-path: lib
    merge-dirs: bin;lib
    subdirectories: true
    no-autodownload: true
modules:
  - shared-modules/libsecret/libsecret.json

  - python3-virtualenv.yaml

  - python3-pipenv.yaml

  - python3-poetry.yaml

  - name: pycharm
    buildsystem: simple
    build-commands:
      - tar xzf pycharm-professional.tar.gz --directory=${FLATPAK_DEST}/ --strip-components 1
      - install -D pycharm ${FLATPAK_DEST}/bin/pycharm
      - install -Dm644 -t ${FLATPAK_DEST}/share/metainfo com.jetbrains.PyCharm-Professional.appdata.xml
      - install -Dm644 -t ${FLATPAK_DEST}/share/applications com.jetbrains.PyCharm-Professional.desktop
      - install -Dm644 -t ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps com.jetbrains.PyCharm-Professional.svg
      - cat idea.properties | tee -a ${FLATPAK_DEST}/bin/idea.properties
      - install -d "${FLATPAK_DEST}/extensions"
      - install -d "${FLATPAK_DEST}/packages"
      - /usr/bin/python3 ${FLATPAK_DEST}/plugins/python/helpers/pydev/setup_cython.py build_ext --inplace
    sources:
      - type: file
        url: https://download.jetbrains.com/python/pycharm-professional-2023.1.tar.gz
        sha256: 26c3f49ad899178105943eb63e1abae85c40f2f44362a2b20629a6263a4f8da6
        size: 732575017
        x-checker-data:
          type: jetbrains
          code: PCP
        dest-filename: pycharm-professional.tar.gz
      - type: file
        path: com.jetbrains.PyCharm-Professional.appdata.xml
      - type: file
        path: com.jetbrains.PyCharm-Professional.desktop
      - type: file
        path: com.jetbrains.PyCharm-Professional.svg
      - type: file
        path: idea.properties
      - type: script
        dest-filename: pycharm
        commands:
          - exec /app/bin/pycharm.sh "$@"
